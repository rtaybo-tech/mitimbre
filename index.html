<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Timbre Digital - Acceso Seguro</title>
    <style>
        :root {
            --primary-color: #25d366;
            --secondary-color: #128c7e;
            --dark-bg: #121212;
            --card-bg: #1e1e1e;
            --text-main: #ffffff;
            --text-dim: #b0b0b0;
            --danger: #ff4444;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Segoe UI', sans-serif; }

        body {
            background-color: var(--dark-bg);
            color: var(--text-main);
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh;
            padding: 20px;
        }

        /* --- MODAL LEGAL --- */
        #legal-modal {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.98); z-index: 2000;
            display: flex; justify-content: center; align-items: center; padding: 20px;
        }

        .modal-content {
            background: var(--card-bg); padding: 25px; border-radius: 20px;
            max-width: 450px; width: 100%; border: 1px solid #333; text-align: center;
        }

        /* --- INTERFAZ PRINCIPAL --- */
        #main-ui { display: none; width: 100%; max-width: 500px; }
        
        header { text-align: center; margin-bottom: 30px; }
        .logo { 
            font-size: 4rem; 
            margin-bottom: 10px; 
            cursor: default; 
            user-select: none;
            -webkit-tap-highlight-color: transparent;
        }
        
        .bell-grid {
            display: grid; grid-template-columns: repeat(auto-fill, minmax(140px, 1fr));
            gap: 15px; margin-bottom: 40px;
        }

        .bell-button {
            background: var(--card-bg); color: white; border: 1px solid #333;
            padding: 25px 10px; border-radius: 15px; cursor: pointer;
            display: flex; flex-direction: column; align-items: center;
            transition: 0.2s;
        }

        .bell-button:active { transform: scale(0.95); background: #333; }
        .bell-button i { font-size: 0.7rem; color: var(--primary-color); font-style: normal; margin-bottom: 5px; }

        /* --- PANEL DE CONFIGURACI칍N --- */
        #admin-panel {
            display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: var(--dark-bg); z-index: 3000; padding: 20px; overflow-y: auto;
        }

        .admin-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; }
        .input-group { margin-bottom: 15px; }
        label { display: block; margin-bottom: 5px; color: var(--text-dim); font-size: 0.9rem; }
        input {
            width: 100%; padding: 12px; border-radius: 8px; border: 1px solid #444;
            background: #2a2a2a; color: white; font-size: 1rem;
        }

        .btn {
            padding: 12px 20px; border-radius: 8px; border: none; font-weight: bold; cursor: pointer; width: 100%;
        }
        .btn-primary { background: var(--primary-color); color: black; }
        .btn-outline { background: transparent; border: 1px solid #444; color: white; margin-top: 10px; }
        .btn-danger { background: var(--danger); color: white; padding: 5px 10px; font-size: 0.8rem; width: auto; }

        .admin-list-item {
            background: #2a2a2a; padding: 15px; border-radius: 10px; margin-bottom: 10px;
            display: flex; justify-content: space-between; align-items: center;
        }

        /* --- ALERTAS --- */
        #custom-alert {
            display: none; position: fixed; bottom: 30px; left: 50%; transform: translateX(-50%);
            background: white; color: black; padding: 25px; border-radius: 20px;
            width: 90%; max-width: 400px; z-index: 4000; text-align: center;
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
        }

    </style>
</head>
<body>

    <!-- MODAL LEGAL (RECUPERADO DEL ORIGINAL) -->
    <div id="legal-modal">
        <div class="modal-content">
            <h2 style="color:var(--primary-color); margin-bottom: 15px;">Aviso Legal</h2>
            <p style="font-size: 0.85rem; color: #ccc; text-align: justify; margin-bottom: 20px; line-height: 1.4;">
                Este sistema es un facilitador de contacto t칠cnico entre visitantes y residentes. El prestador del servicio no se responsabiliza por el contenido de los mensajes enviados ni por el uso indebido de la plataforma. Al continuar, usted acepta que el sistema redirigir치 su solicitud a la aplicaci칩n WhatsApp del destinatario. No se almacenan datos personales en servidores externos conforme a la Ley 25.326 de Protecci칩n de Datos Personales.
            </p>
            <button class="btn btn-primary" onclick="acceptLegal()">Acepto y deseo continuar</button>
        </div>
    </div>

    <!-- INTERFAZ PRINCIPAL -->
    <div id="main-ui">
        <header>
            <!-- Acceso: 4 clics aqu칤 -->
            <div class="logo" id="logo-trigger" onclick="handleLogoClick()">游댒</div>
            <h1>Timbre Digital</h1>
            <p style="color: var(--text-dim);">Toque el bot칩n correspondiente para anunciar su llegada</p>
        </header>

        <div class="bell-grid" id="bell-grid"></div>

        <footer style="text-align: center; margin-top: 40px;">
            <p style="font-size: 0.7rem; color: #333;">Sistema de Enlace T칠cnico v2.2</p>
        </footer>
    </div>

    <!-- PANEL ADMIN -->
    <div id="admin-panel">
        <div class="admin-header">
            <h2>Panel de Configuraci칩n</h2>
            <button class="btn btn-outline" style="width: auto;" onclick="closeAdmin()">Salir</button>
        </div>

        <div style="background: var(--card-bg); padding: 15px; border-radius: 15px; margin-bottom: 30px;">
            <h3 style="margin-bottom: 15px;">A침adir Timbre</h3>
            <div class="input-group">
                <label>Nombre del Departamento / Local</label>
                <input type="text" id="new-name" placeholder="Ej: Departamento 4B">
            </div>
            <div class="input-group">
                <label>WhatsApp (Ej: 5491100000000)</label>
                <input type="number" id="new-phone" placeholder="N칰mero completo sin el +">
            </div>
            <button class="btn btn-primary" onclick="addTimbre()">Guardar Timbre</button>
        </div>

        <h3>Timbres Registrados</h3>
        <div id="admin-list" style="margin-top: 15px;"></div>
    </div>

    <!-- ALERTA DE LLAMADA (CON LEYENDA ORIGINAL) -->
    <div id="custom-alert">
        <h3 style="margin-bottom: 10px;">Confirmar Env칤o</h3>
        <p id="alert-text" style="margin-bottom: 15px; font-size: 0.95rem;"></p>
        <p style="font-size: 0.75rem; color: #666; margin-bottom: 20px;">
            Al pulsar "Enviar", se abrir치 WhatsApp con un mensaje predeterminado.
        </p>
        <div style="display: flex; gap: 10px;">
            <button class="btn btn-outline" style="color: black; border-color: #ccc;" onclick="closeAlert()">Cancelar</button>
            <button class="btn btn-primary" id="confirm-btn">Enviar Mensaje</button>
        </div>
    </div>

    <script>
        // Sistema de seguridad por 4 clicks
        let clickCount = 0;
        let lastClickTime = 0;

        function handleLogoClick() {
            const now = Date.now();
            if (now - lastClickTime > 1500) clickCount = 0; 
            clickCount++;
            lastClickTime = now;
            if (clickCount === 4) {
                clickCount = 0;
                checkAdminPassword();
            }
        }

        // Carga de datos de localStorage
        let listadoTimbres = JSON.parse(localStorage.getItem('timbres_config')) || [
            { id: 1, nombre: "Porter칤a", whatsapp: "5491100000000" }
        ];

        const mensajeDefault = "游댒 *AVISO DE TIMBRE*: Hay alguien en la puerta solicitando atenci칩n.";

        function renderTimbres() {
            const grid = document.getElementById('bell-grid');
            const adminList = document.getElementById('admin-list');
            grid.innerHTML = '';
            adminList.innerHTML = '';

            listadoTimbres.forEach((item, index) => {
                const btn = document.createElement('button');
                btn.className = 'bell-button';
                btn.innerHTML = `<i>TIMBRE</i> <strong>${item.nombre}</strong>`;
                btn.onclick = () => showAlert(item);
                grid.appendChild(btn);

                const itemDiv = document.createElement('div');
                itemDiv.className = 'admin-list-item';
                itemDiv.innerHTML = `
                    <div>
                        <strong>${item.nombre}</strong><br>
                        <small style="color:var(--text-dim)">${item.whatsapp}</small>
                    </div>
                    <button class="btn btn-danger" onclick="removeTimbre(${index})">Eliminar</button>
                `;
                adminList.appendChild(itemDiv);
            });
            
            localStorage.setItem('timbres_config', JSON.stringify(listadoTimbres));
        }

        function addTimbre() {
            const name = document.getElementById('new-name').value;
            const phone = document.getElementById('new-phone').value;
            if(!name || !phone) return alert("Por favor complete los campos.");
            listadoTimbres.push({ id: Date.now(), nombre: name, whatsapp: phone });
            document.getElementById('new-name').value = '';
            document.getElementById('new-phone').value = '';
            renderTimbres();
        }

        function removeTimbre(index) {
            if(confirm("쯉eguro desea eliminar este registro?")) {
                listadoTimbres.splice(index, 1);
                renderTimbres();
            }
        }

        function checkAdminPassword() {
            const pass = prompt("Ingrese la clave de configuraci칩n:");
            if(pass === "siso1926") {
                document.getElementById('admin-panel').style.display = 'block';
            } else {
                alert("Clave incorrecta.");
            }
        }

        function closeAdmin() {
            document.getElementById('admin-panel').style.display = 'none';
        }

        function acceptLegal() {
            document.getElementById('legal-modal').style.display = 'none';
            document.getElementById('main-ui').style.display = 'block';
            renderTimbres();
        }

        function showAlert(item) {
            const alertBox = document.getElementById('custom-alert');
            document.getElementById('alert-text').innerHTML = `쮻esea avisar a <b>${item.nombre}</b> que se encuentra en la puerta?`;
            alertBox.style.display = 'block';
            document.getElementById('confirm-btn').onclick = () => {
                const url = `https://api.whatsapp.com/send?phone=${item.whatsapp}&text=${encodeURIComponent(mensajeDefault)}`;
                window.location.href = url;
            };
        }

        function closeAlert() {
            document.getElementById('custom-alert').style.display = 'none';
        }
    </script>
</body>
</html>
